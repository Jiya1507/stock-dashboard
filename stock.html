<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Indian Share Market Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bull: '#16a34a',
                        bear: '#dc2626',
                        nifty: '#2563eb',
                        sensex: '#9333ea',
                        reliance: '#0e4c92',
                        darkBg: '#0f172a',
                        cardDark: '#1e293b'
                    }
                }
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: #0f172a;
            color: #e2e8f0;
        }
        
        .card {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border-radius: 12px;
            overflow: hidden;
            background: #1e293b;
            border: 1px solid #334155;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.3);
        }
        
        .positive-change {
            color: #16a34a;
        }
        
        .negative-change {
            color: #dc2626;
        }
        
        .blink {
            animation: blink-animation 1s steps(2, start) infinite;
        }
        
        @keyframes blink-animation {
            to {
                visibility: hidden;
            }
        }
        
        .market-open {
            background: linear-gradient(90deg, #16a34a, #22c55e);
        }
        
        .market-closed {
            background: linear-gradient(90deg, #475569, #64748b);
        }
        
        .loader {
            border-top-color: #3b82f6;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .refresh-btn {
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: rotate(180deg);
        }
        
        .stock-table {
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .stock-table th {
            background-color: #1e293b;
            position: sticky;
            top: 0;
            color: #cbd5e1;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        .api-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 12px;
            z-index: 100;
        }
        
        .api-status.live {
            background-color: #16a34a;
            color: white;
        }
        
        .api-status.demo {
            background-color: #f59e0b;
            color: white;
        }
        
        .tabs button.active {
            background-color: #3b82f6;
            color: white;
        }
        
        .bull-bear-container {
            max-height: 400px;
            overflow-y: auto;
        }
        
        .bull-bear-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .bull-bear-container::-webkit-scrollbar-track {
            background: #1e293b;
            border-radius: 10px;
        }
        
        .bull-bear-container::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 10px;
        }
        
        .header-bg {
            background: #1e293b;
            border-bottom: 1px solid #334155;
        }
    </style>
</head>
<body class="bg-darkBg min-h-screen">
    <!-- Header -->
    <header class="header-bg shadow-sm">
        <div class="container mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center">
                <div class="bg-blue-600 text-white p-2 rounded-lg">
                    <i class="fas fa-chart-line text-2xl"></i>
                </div>
                <div class="ml-3">
                    <h1 class="text-xl font-bold text-gray-100">Indian Share Market Dashboard</h1>
                    <p class="text-xs text-gray-400">Real-time stock data with Alpha Vantage API</p>
                </div>
            </div>
            
            <div class="flex items-center">
                <div id="market-status" class="market-open px-3 py-1 rounded-full text-white text-sm flex items-center">
                    <i class="fas fa-circle text-xs mr-1"></i>
                    <span>Market Open</span>
                </div>
                <div class="ml-4 text-right">
                    <div id="current-time" class="text-gray-100 font-medium">10:15:32 AM</div>
                    <div id="current-date" class="text-xs text-gray-400">Mon, 12 Jun 2023</div>
                </div>
                <button id="refresh-btn" class="ml-4 bg-blue-900 text-blue-300 p-2 rounded-lg refresh-btn">
                    <i class="fas fa-sync-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-6">
        <!-- Loading Indicator -->
        <div id="loading-indicator" class="fixed inset-0 bg-gray-800 bg-opacity-70 flex items-center justify-center z-50 hidden">
            <div class="bg-cardDark p-6 rounded-lg shadow-xl flex items-center border border-gray-700">
                <div class="loader rounded-full h-10 w-10 border-4 border-t-4 border-gray-200"></div>
                <p class="ml-4 text-gray-300">Fetching real-time data...</p>
            </div>
        </div>

        <!-- Index Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="card p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-200">NIFTY 50</h2>
                    <span class="text-xs px-2 py-1 bg-nifty bg-opacity-20 text-blue-300 rounded">NSE</span>
                </div>
                <div class="flex items-end">
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-gray-100" id="nifty-price">18,826.70</div>
                        <div class="flex items-center mt-2">
                            <span class="positive-change font-medium" id="nifty-change">+182.45 (1.00%)</span>
                            <i class="fas fa-arrow-up ml-2 positive-change"></i>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-400">Prev Close</div>
                        <div class="text-gray-300 font-medium" id="nifty-prev">18,644.25</div>
                    </div>
                </div>
            </div>
            
            <div class="card p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-200">SENSEX</h2>
                    <span class="text-xs px-2 py-1 bg-sensex bg-opacity-20 text-purple-300 rounded">BSE</span>
                </div>
                <div class="flex items-end">
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-gray-100" id="sensex-price">63,416.03</div>
                        <div class="flex items-center mt-2">
                            <span class="positive-change font-medium" id="sensex-change">+562.31 (0.90%)</span>
                            <i class="fas fa-arrow-up ml-2 positive-change"></i>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-400">Prev Close</div>
                        <div class="text-gray-300 font-medium" id="sensex-prev">62,853.72</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Market Overview -->
        <div class="card shadow mb-8">
            <div class="border-b border-gray-700 px-6 py-4">
                <h2 class="text-lg font-semibold text-gray-200">Market Overview</h2>
            </div>
            <div class="px-6 py-4 grid grid-cols-2 md:grid-cols-4 gap-4">
                <div class="text-center p-4 bg-green-900 bg-opacity-30 rounded-lg">
                    <div class="text-2xl font-bold text-bull" id="advancing">1,842</div>
                    <div class="text-sm text-gray-400">Advancing</div>
                </div>
                <div class="text-center p-4 bg-red-900 bg-opacity-30 rounded-lg">
                    <div class="text-2xl font-bold text-bear" id="declining">962</div>
                    <div class="text-sm text-gray-400">Declining</div>
                </div>
                <div class="text-center p-4 bg-gray-700 rounded-lg">
                    <div class="text-2xl font-bold text-gray-300" id="unchanged">138</div>
                    <div class="text-sm text-gray-400">Unchanged</div>
                </div>
                <div class="text-center p-4 bg-blue-900 bg-opacity-30 rounded-lg">
                    <div class="text-2xl font-bold text-blue-400" id="sentiment">72%</div>
                    <div class="text-sm text-gray-400">Bullish Sentiment</div>
                </div>
            </div>
        </div>

        <!-- Stock Selector -->
        <div class="card p-6 shadow mb-8">
            <h2 class="text-lg font-semibold text-gray-200 mb-4">Select Stock</h2>
            <div class="flex flex-wrap gap-2">
                <button data-symbol="RELIANCE.BSE" class="stock-btn px-4 py-2 bg-reliance text-white rounded-lg flex items-center">
                    <i class="fas fa-building text-white mr-2"></i>Reliance
                </button>
                <button data-symbol="TCS.BSE" class="stock-btn px-4 py-2 bg-gray-700 text-white rounded-lg">
                    TCS
                </button>
                <button data-symbol="INFY.BSE" class="stock-btn px-4 py-2 bg-blue-600 text-white rounded-lg">
                    Infosys
                </button>
                <button data-symbol="HDFCBANK.BSE" class="stock-btn px-4 py-2 bg-blue-800 text-white rounded-lg">
                    HDFC Bank
                </button>
                <button data-symbol="ICICIBANK.BSE" class="stock-btn px-4 py-2 bg-blue-700 text-white rounded-lg">
                    ICICI Bank
                </button>
            </div>
        </div>

        <!-- Stock Details -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
            <div class="card p-6 lg:col-span-1">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-lg font-semibold text-gray-200" id="stock-name">Reliance Industries</h2>
                    <span class="text-xs px-2 py-1 bg-reliance text-white rounded">BSE</span>
                </div>
                <div class="flex items-end mb-4">
                    <div class="flex-1">
                        <div class="text-3xl font-bold text-gray-100" id="stock-price">--</div>
                        <div class="flex items-center mt-2">
                            <span class="positive-change font-medium" id="stock-change">--</span>
                            <i class="fas fa-arrow-up ml-2 positive-change" id="stock-icon"></i>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4 mt-6">
                    <div>
                        <div class="text-sm text-gray-400">Open</div>
                        <div class="text-gray-300 font-medium" id="stock-open">--</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-400">High</div>
                        <div class="text-gray-300 font-medium" id="stock-high">--</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-400">Low</div>
                        <div class="text-gray-300 font-medium" id="stock-low">--</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-400">Volume</div>
                        <div class="text-gray-300 font-medium" id="stock-volume">--</div>
                    </div>
                </div>
            </div>
            
            <div class="card p-6 lg:col-span-2">
                <h2 class="text-lg font-semibold text-gray-200 mb-4">Price Chart (Last 30 Days)</h2>
                <div class="chart-container">
                    <canvas id="price-chart"></canvas>
                </div>
            </div>
        </div>
        
        <!-- Bulls & Bears Section -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
            <div class="card p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-green-400">Bullish Stocks</h2>
                    <span class="text-xs px-2 py-1 bg-green-900 bg-opacity-30 text-green-300 rounded">Gaining</span>
                </div>
                <div class="bull-bear-container">
                    <ul id="bullsList" class="space-y-2"></ul>
                </div>
            </div>
            
            <div class="card p-6">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-red-400">Bearish Stocks</h2>
                    <span class="text-xs px-2 py-1 bg-red-900 bg-opacity-30 text-red-300 rounded">Declining</span>
                </div>
                <div class="bull-bear-container">
                    <ul id="bearsList" class="space-y-2"></ul>
                </div>
            </div>
        </div>
        
        <!-- Tabs for different views -->
        <div class="card shadow mb-8">
            <div class="border-b border-gray-700 px-6 py-4 flex justify-between items-center">
                <h2 class="text-lg font-semibold text-gray-200">Top Stocks</h2>
                <div class="tabs flex">
                    <button id="daily-tab" class="px-4 py-2 rounded-l-lg bg-blue-900 text-blue-200 active">Daily Data</button>
                    <button id="weekly-tab" class="px-4 py-2 bg-gray-700 text-gray-300">Weekly Data</button>
                    <button id="monthly-tab" class="px-4 py-2 rounded-r-lg bg-gray-700 text-gray-300">Monthly Data</button>
                </div>
            </div>
            <div class="overflow-x-auto">
                <table class="w-full stock-table">
                    <thead>
                        <tr class="text-left border-b border-gray-700 text-gray-400 text-sm">
                            <th class="px-6 py-3">Date</th>
                            <th class="px-6 py-3">Open</th>
                            <th class="px-6 py-3">High</th>
                            <th class="px-6 py-3">Low</th>
                            <th class="px-6 py-3">Close</th>
                            <th class="px-6 py-3">Volume</th>
                        </tr>
                    </thead>
                    <tbody id="stock-data-body">
                        <tr class="border-b border-gray-700 hover:bg-gray-800">
                            <td class="px-6 py-4 font-medium text-gray-300 text-center" colspan="6">
                                <div class="flex justify-center items-center py-4">
                                    <div class="loader rounded-full h-6 w-6 border-2 border-t-2 border-gray-200 mr-2"></div>
                                    Loading stock data...
                                </div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Market Prediction -->
        <div class="card p-6 shadow mb-8">
            <h2 class="text-lg font-semibold text-gray-200 mb-4">Market Analysis</h2>
            <div class="flex items-center">
                <div class="flex-1">
                    <div class="flex items-center">
                        <div class="w-16 h-16 rounded-full bg-green-900 bg-opacity-30 flex items-center justify-center">
                            <i class="fas fa-arrow-up text-3xl text-bull"></i>
                        </div>
                        <div class="ml-4">
                            <h3 class="font-bold text-gray-200" id="analysis-title">Analyzing Trends</h3>
                            <p class="text-sm text-gray-400" id="analysis-text">Calculating market trends based on historical data</p>
                        </div>
                    </div>
                </div>
                <div class="text-right">
                    <div class="text-3xl font-bold text-bull" id="confidence-level">--%</div>
                    <div class="text-sm text-gray-400">Confidence Level</div>
                </div>
            </div>
            <div class="mt-6 bg-gray-700 h-2 rounded-full overflow-hidden">
                <div class="bg-bull h-2 w-3/4" id="sentiment-bar"></div>
            </div>
            <div class="mt-2 flex justify-between text-sm text-gray-400">
                <span>Bearish</span>
                <span>Neutral</span>
                <span>Bullish</span>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 py-8 border-t border-gray-800">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <p class="text-sm">© <span id="currentYear">2023</span> Indian Share Market Dashboard. All rights reserved.</p>
                <p class="text-xs text-gray-500 mt-2">Data provided by Alpha Vantage. This is for demonstration purposes only and not intended for investment advice.</p>
                <p class="text-xs text-gray-500 mt-1">Last updated: <span id="last-updated-time">--</span></p>
            </div>
        </div>
    </footer>

    <!-- API Status Indicator -->
    <div id="api-status" class="api-status demo">
        <i class="fas fa-circle text-xs mr-1"></i> Alpha Vantage API
    </div>

    <script>
        // Set current year in footer
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        
        // Alpha Vantage API key
        const API_KEY = 'demo'; // Using demo key for Alpha Vantage
        let currentSymbol = 'RELIANCE.BSE';
        let priceChart = null;
        
        // Sample stock data for Bulls & Bears and Top Stocks table
        const stocks = [
            { symbol: 'RELIANCE', price: 2588.45, change: 42.35, changePercent: 1.66, volume: '3.2M', prediction: 'Bullish' },
            { symbol: 'TCS', price: 3320.80, change: -28.50, changePercent: -0.85, volume: '1.8M', prediction: 'Neutral' },
            { symbol: 'HDFCBANK', price: 1645.30, change: 22.75, changePercent: 1.40, volume: '4.5M', prediction: 'Bullish' },
            { symbol: 'INFY', price: 1425.60, change: 15.25, changePercent: 1.08, volume: '2.3M', prediction: 'Bullish' },
            { symbol: 'ICICIBANK', price: 918.75, change: -12.40, changePercent: -1.33, volume: '3.7M', prediction: 'Bearish' },
            { symbol: 'HINDUNILVR', price: 2590.00, change: 35.50, changePercent: 1.39, volume: '1.2M', prediction: 'Bullish' },
            { symbol: 'SBIN', price: 582.40, change: -8.35, changePercent: -1.41, volume: '5.1M', prediction: 'Bearish' },
            { symbol: 'BAJFINANCE', price: 6845.95, change: 102.25, changePercent: 1.52, volume: '0.9M', prediction: 'Bullish' },
            { symbol: 'WIPRO', price: 388.55, change: -5.20, changePercent: -1.32, volume: '2.8M', prediction: 'Neutral' },
            { symbol: 'ADANIPORTS', price: 738.20, change: 18.65, changePercent: 2.59, volume: '2.1M', prediction: 'Bullish' }
        ];

        // Example Indian stock symbols to simulate
        const stockSymbols = [
            "RELIANCE", "TCS", "HDFCBANK", "INFY", "LT", "ICICIBANK", 
            "SBIN", "HINDUNILVR", "KOTAKBANK", "BHARTIARTL"
        ];

        // Function to generate random stock data for bulls and bears
        function generateStock(name) {
            const price = (100 + Math.random() * 900).toFixed(2);
            const change = parseFloat((Math.random() * 5).toFixed(2));
            const isBull = Math.random() > 0.5;
            return {
                symbol: name,
                price: price,
                change: isBull ? change : -change,
            };
        }

        // Function to update bulls and bears lists
        function updateBullBearLists() {
            const bullsList = document.getElementById('bullsList');
            const bearsList = document.getElementById('bearsList');
            bullsList.innerHTML = '';
            bearsList.innerHTML = '';

            const bulls = [];
            const bears = [];

            stockSymbols.forEach(symbol => {
                const stock = generateStock(symbol);
                if (stock.change >= 0) {
                    bulls.push(stock);
                } else {
                    bears.push(stock);
                }
            });

            // Sort by change percentage
            bulls.sort((a, b) => b.change - a.change);
            bears.sort((a, b) => a.change - b.change);

            // Display top 5 bulls and bears
            bulls.slice(0, 5).forEach(stock => {
                const li = document.createElement('li');
                li.className = 'p-3 bg-green-900 bg-opacity-20 rounded flex justify-between items-center';
                li.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-green-900 bg-opacity-30 flex items-center justify-center mr-3">
                            <i class="fas fa-arrow-up text-green-400"></i>
                        </div>
                        <span class="font-medium text-gray-300">${stock.symbol}</span>
                    </div>
                    <div class="text-right">
                        <div class="text-green-400 font-semibold">+${stock.change.toFixed(2)}%</div>
                        <div class="text-xs text-gray-400">₹${stock.price}</div>
                    </div>
                `;
                bullsList.appendChild(li);
            });

            bears.slice(0, 5).forEach(stock => {
                const li = document.createElement('li');
                li.className = 'p-3 bg-red-900 bg-opacity-20 rounded flex justify-between items-center';
                li.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 rounded-full bg-red-900 bg-opacity-30 flex items-center justify-center mr-3">
                            <i class="fas fa-arrow-down text-red-400"></i>
                        </div>
                        <span class="font-medium text-gray-300">${stock.symbol}</span>
                    </div>
                    <div class="text-right">
                        <div class="text-red-400 font-semibold">${stock.change.toFixed(2)}%</div>
                        <div class="text-xs text-gray-400">₹${stock.price}</div>
                    </div>
                `;
                bearsList.appendChild(li);
            });
        }

        // Function to update market overview data
        function updateMarketOverview() {
            // Randomly update market overview numbers
            document.getElementById('advancing').textContent = Math.floor(1200 + Math.random() * 800);
            document.getElementById('declining').textContent = Math.floor(800 + Math.random() * 400);
            document.getElementById('unchanged').textContent = Math.floor(100 + Math.random() * 100);
            document.getElementById('sentiment').textContent = Math.floor(60 + Math.random() * 20) + '%';
            
            // Update Nifty and Sensex values
            const niftyChange = (Math.random() * 200).toFixed(2);
            const sensexChange = (Math.random() * 600).toFixed(2);
            
            document.getElementById('nifty-price').textContent = (18800 + parseFloat(niftyChange)).toFixed(2);
            document.getElementById('nifty-change').textContent = `+${niftyChange} (${(niftyChange/18800 * 100).toFixed(2)}%)`;
            
            document.getElementById('sensex-price').textContent = (63400 + parseFloat(sensexChange)).toFixed(2);
            document.getElementById('sensex-change').textContent = `+${sensexChange} (${(sensexChange/63400 * 100).toFixed(2)}%)`;
        }
        
        // Function to fetch stock data from Alpha Vantage
        async function fetchStockData() {
            showLoading();
            
            try {
                // Fetch daily time series data
                const response = await fetch(`https://www.alphavantage.co/query?function=TIME_SERIES_DAILY&symbol=${currentSymbol}&outputsize=compact&apikey=${API_KEY}`);
                const data = await response.json();
                
                if (data['Time Series (Daily)']) {
                    processStockData(data);
                    document.getElementById('api-status').className = 'api-status live';
                    document.getElementById('api-status').innerHTML = '<i class="fas fa-circle text-xs mr-1"></i> Live Data';
                } else {
                    throw new Error('Invalid API response');
                }
                
                updateLastUpdatedTime();
            } catch (error) {
                console.error('Error fetching stock data:', error);
                // Fallback to simulated data if API fails
                useSimulatedData();
                document.getElementById('api-status').className = 'api-status demo';
                document.getElementById('api-status').innerHTML = '<i class="fas fa-circle text-xs mr-1"></i> Demo Data';
            } finally {
                hideLoading();
            }
        }
        
        // Function to process stock data from Alpha Vantage
        function processStockData(data) {
            const timeSeries = data['Time Series (Daily)'];
            const dates = Object.keys(timeSeries).sort();
            const latestDate = dates[dates.length - 1];
            const previousDate = dates[dates.length - 2];
            
            const latestData = timeSeries[latestDate];
            const previousData = timeSeries[previousDate];
            
            // Update stock details
            const price = parseFloat(latestData['4. close']);
            const previousClose = parseFloat(previousData['4. close']);
            const change = price - previousClose;
            const changePercent = (change / previousClose) * 100;
            
            const isPositive = change >= 0;
            const changeClass = isPositive ? 'positive-change' : 'negative-change';
            const changeIcon = isPositive ? 'fa-arrow-up' : 'fa-arrow-down';
            
            document.getElementById('stock-price').textContent = `₹${price.toFixed(2)}`;
            document.getElementById('stock-change').textContent = 
                `${isPositive ? '+' : ''}${change.toFixed(2)} (${isPositive ? '+' : ''}${changePercent.toFixed(2)}%)`;
            document.getElementById('stock-change').className = `${changeClass} font-medium`;
            document.getElementById('stock-icon').className = `fas ${changeIcon} ml-2 ${changeClass}`;
            
            document.getElementById('stock-open').textContent = `₹${parseFloat(latestData['1. open']).toFixed(2)}`;
            document.getElementById('stock-high').textContent = `₹${parseFloat(latestData['2. high']).toFixed(2)}`;
            document.getElementById('stock-low').textContent = `₹${parseFloat(latestData['3. low']).toFixed(2)}`;
            document.getElementById('stock-volume').textContent = formatVolume(parseFloat(latestData['5. volume']));
            
            // Update stock name based on symbol
            const stockNames = {
                'RELIANCE.BSE': 'Reliance Industries',
                'TCS.BSE': 'Tata Consultancy Services',
                'INFY.BSE': 'Infosys Limited',
                'HDFCBANK.BSE': 'HDFC Bank Limited',
                'ICICIBANK.BSE': 'ICICI Bank Limited'
            };
            
            document.getElementById('stock-name').textContent = stockNames[currentSymbol] || currentSymbol;
            
            // Update data table
            updateDataTable(timeSeries);
            
            // Update chart
            updateChart(timeSeries);
            
            // Update market analysis
            updateMarketAnalysis(timeSeries);
        }
        
        // Function to update data table
        function updateDataTable(timeSeries) {
            const tableBody = document.getElementById('stock-data-body');
            tableBody.innerHTML = '';
            
            const dates = Object.keys(timeSeries).sort().reverse().slice(0, 10);
            
            dates.forEach(date => {
                const data = timeSeries[date];
                const isPositive = parseFloat(data['4. close']) > parseFloat(data['1. open']);
                const rowClass = isPositive ? 'positive-change' : 'negative-change';
                
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 hover:bg-gray-800';
                row.innerHTML = `
                    <td class="px-6 py-4 font-medium text-gray-300">${date}</td>
                    <td class="px-6 py-4 text-gray-300">₹${parseFloat(data['1. open']).toFixed(2)}</td>
                    <td class="px-6 py-4 text-gray-300">₹${parseFloat(data['2. high']).toFixed(2)}</td>
                    <td class="px-6 py-4 text-gray-300">₹${parseFloat(data['3. low']).toFixed(2)}</td>
                    <td class="px-6 py-4 ${rowClass}">₹${parseFloat(data['4. close']).toFixed(2)}</td>
                    <td class="px-6 py-4 text-gray-400">${formatVolume(parseFloat(data['5. volume']))}</td>
                `;
                
                tableBody.appendChild(row);
            });
        }
        
        // Function to update chart
        function updateChart(timeSeries) {
            const dates = Object.keys(timeSeries).sort();
            const recentDates = dates.slice(-30); // Last 30 days
            const prices = recentDates.map(date => parseFloat(timeSeries[date]['4. close']));
            
            const ctx = document.getElementById('price-chart').getContext('2d');
            
            // Destroy previous chart if it exists
            if (priceChart) {
                priceChart.destroy();
            }
            
            // Create new chart
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: recentDates,
                    datasets: [{
                        label: 'Closing Price',
                        data: prices,
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false,
                            backgroundColor: '#1e293b',
                            titleColor: '#e2e8f0',
                            bodyColor: '#cbd5e1',
                            borderColor: '#334155',
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    return `₹${context.raw.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false,
                                color: '#334155'
                            },
                            ticks: {
                                color: '#94a3b8'
                            }
                        },
                        y: {
                            grid: {
                                color: '#334155'
                            },
                            ticks: {
                                color: '#94a3b8',
                                callback: function(value) {
                                    return '₹' + value;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Function to update market analysis
        function updateMarketAnalysis(timeSeries) {
            const dates = Object.keys(timeSeries).sort();
            const recentDates = dates.slice(-30); // Last 30 days
            const prices = recentDates.map(date => parseFloat(timeSeries[date]['4. close']));
            
            // Simple trend analysis
            const firstPrice = prices[0];
            const lastPrice = prices[prices.length - 1];
            const trend = lastPrice > firstPrice ? 'bullish' : 'bearish';
            const changePercent = ((lastPrice - firstPrice) / firstPrice) * 100;
            
            // Calculate confidence level based on volatility
            let sum = 0;
            for (let i = 1; i < prices.length; i++) {
                sum += Math.abs(prices[i] - prices[i-1]) / prices[i-1];
            }
            const volatility = sum / (prices.length - 1);
            const confidence = Math.max(30, Math.min(95, 100 - (volatility * 1000)));
            
            document.getElementById('confidence-level').textContent = `${confidence.toFixed(0)}%`;
            document.getElementById('sentiment-bar').style.width = `${confidence}%`;
            
            if (trend === 'bullish') {
                document.getElementById('analysis-title').textContent = 'Bullish Trend';
                document.getElementById('analysis-text').textContent = `Stock has increased by ${changePercent.toFixed(2)}% over the last 30 days`;
                document.getElementById('sentiment-bar').className = 'bg-bull h-2';
            } else {
                document.getElementById('analysis-title').textContent = 'Bearish Trend';
                document.getElementById('analysis-text').textContent = `Stock has decreased by ${Math.abs(changePercent).toFixed(2)}% over the last 30 days`;
                document.getElementById('sentiment-bar').className = 'bg-bear h-2';
            }
        }
        
        // Function to format volume
        function formatVolume(volume) {
            if (volume >= 1000000) {
                return (volume / 1000000).toFixed(1) + 'M';
            } else if (volume >= 1000) {
                return (volume / 1000).toFixed(1) + 'K';
            }
            return volume;
        }
        
        // Function to update last updated time
        function updateLastUpdatedTime() {
            const now = new Date();
            document.getElementById('last-updated-time').textContent = now.toLocaleTimeString();
        }
        
        // Function to show loading indicator
        function showLoading() {
            document.getElementById('loading-indicator').classList.remove('hidden');
        }
        
        // Function to hide loading indicator
        function hideLoading() {
            document.getElementById('loading-indicator').classList.add('hidden');
        }
        
        // Function to use simulated data if API fails
        function useSimulatedData() {
            // Generate simulated data for demonstration
            const simulatedData = {
                'Time Series (Daily)': {}
            };
            
            const today = new Date();
            for (let i = 0; i < 30; i++) {
                const date = new Date();
                date.setDate(today.getDate() - i);
                const dateStr = date.toISOString().split('T')[0];
                
                const basePrice = 2500 + Math.random() * 100;
                const open = basePrice + (Math.random() * 20 - 10);
                const high = open + Math.random() * 30;
                const low = open - Math.random() * 30;
                const close = open + (Math.random() * 40 - 20);
                const volume = 5000000 + Math.random() * 10000000;
                
                simulatedData['Time Series (Daily)'][dateStr] = {
                    '1. open': open.toFixed(4),
                    '2. high': high.toFixed(4),
                    '3. low': low.toFixed(4),
                    '4. close': close.toFixed(4),
                    '5. volume': volume.toFixed(0)
                };
            }
            
            processStockData(simulatedData);
            updateLastUpdatedTime();
        }
        
        // Function to update time and date
        function updateDateTime() {
            const now = new Date();
            const timeElement = document.getElementById('current-time');
            const dateElement = document.getElementById('current-date');
            
            timeElement.textContent = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            dateElement.textContent = now.toLocaleDateString('en-IN', { weekday: 'short', day: 'numeric', month: 'short', year: 'numeric' });
            
            // Update market status based on time (9:15 AM to 3:30 PM IST)
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const isMarketOpen = (hours > 9 || (hours === 9 && minutes >= 15)) && (hours < 15 || (hours === 15 && minutes <= 30));
            
            const marketStatusElement = document.getElementById('market-status');
            if (isMarketOpen) {
                marketStatusElement.className = 'market-open px-3 py-1 rounded-full text-white text-sm flex items-center';
                marketStatusElement.innerHTML = '<i class="fas fa-circle text-xs mr-1 blink"></i><span>Market Open</span>';
            } else {
                marketStatusElement.className = 'market-closed px-3 py-1 rounded-full text-white text-sm flex items-center';
                marketStatusElement.innerHTML = '<i class="fas fa-circle text-xs mr-1"></i><span>Market Closed</span>';
            }
        }
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            // Set up stock buttons
            document.querySelectorAll('.stock-btn').forEach(button => {
                button.addEventListener('click', function() {
                    currentSymbol = this.getAttribute('data-symbol');
                    fetchStockData();
                });
            });
            
            // Set up tabs
            document.getElementById('daily-tab').addEventListener('click', function() {
                document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                // In a real implementation, you would fetch daily data here
            });
            
            document.getElementById('weekly-tab').addEventListener('click', function() {
                document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                // In a real implementation, you would fetch weekly data here
            });
            
            document.getElementById('monthly-tab').addEventListener('click', function() {
                document.querySelectorAll('.tabs button').forEach(btn => btn.classList.remove('active'));
                this.classList.add('active');
                // In a real implementation, you would fetch monthly data here
            });
            
            // Set up refresh button
            document.getElementById('refresh-btn').addEventListener('click', function() {
                fetchStockData();
                updateBullBearLists();
                updateMarketOverview();
            });
            
            // Fetch data immediately
            fetchStockData();
            updateBullBearLists();
            updateMarketOverview();
            updateDateTime();
            
            // Update time every second
            setInterval(updateDateTime, 1000);
            
            // Update stock data every 5 minutes
            setInterval(fetchStockData, 300000);
            
            // Update market data every 10 seconds
            setInterval(function() {
                updateBullBearLists();
                updateMarketOverview();
            }, 10000);
        });
    </script>
</body>
</html>